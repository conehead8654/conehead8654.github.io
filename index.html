<style>
    #fullscreenBtn, #leaveBtn {
        position: absolute;
        top: 10px;
        right: 10px;
        background: #ff0000;
        color: white;
        padding: 8px 16px;
        border: 2px solid white;
        border-radius: 5px;
        cursor: pointer;
        z-index: 15000 !important;
        display: block;
    }
    #leaveBtn {
        top: 50px;
    }
    #ui button {
        background: #ff0000;
        color: white;
        padding: 8px 16px;
        border: 2px solid white;
        border-radius: 5px;
        cursor: pointer;
        z-index: 10001 !important;
        position: relative;
        display: inline-block;
        margin: 5px;
    }
</style>
<script>
function toggleFullscreen() {
    try {
        const fullscreenBtn = document.getElementById('fullscreenBtn');
        if (!document.fullscreenElement) {
            document.documentElement.requestFullscreen().then(() => {
                fullscreenBtn.textContent = 'Exit Fullscreen';
                console.log('Entered fullscreen mode');
            }).catch(e => {
                console.error('Fullscreen error:', e);
                alert('Failed to enter fullscreen mode. Check console.');
            });
        } else {
            document.exitFullscreen().then(() => {
                fullscreenBtn.textContent = 'Fullscreen';
                console.log('Exited fullscreen mode');
            }).catch(e => {
                console.error('Exit fullscreen error:', e);
                alert('Failed to exit fullscreen mode. Check console.');
            });
        }
    } catch (e) {
        console.error('Toggle fullscreen error:', e);
        alert('Error toggling fullscreen. Check console.');
    }
}

function renderMainMenu() {
    try {
        ui.style.display = 'block';
        ui.innerHTML = `
            <button style="background: #ff0000; color: white; padding: 8px 16px; border: 2px solid white; border-radius: 5px; cursor: pointer; z-index: 10001; position: relative; display: inline-block; margin: 5px;" onclick="startGame()">Start Game</button>
            <button style="background: #ff0000; color: white; padding: 8px 16px; border: 2px solid white; border-radius: 5px; cursor: pointer; z-index: 10001; position: relative; display: inline-block; margin: 5px;" onclick="openSkinShop()">Skin Shop</button>
            <button style="background: #ff0000; color: white; padding: 8px 16px; border: 2px solid white; border-radius: 5px; cursor: pointer; z-index: 10001; position: relative; display: inline-block; margin: 5px;" onclick="openWeaponShop()">Weapon Shop</button>
            <button style="background: #ff0000; color: white; padding: 8px 16px; border: 2px solid white; border-radius: 5px; cursor: pointer; z-index: 10001; position: relative; display: inline-block; margin: 5px;" onclick="togglePlayerList()">Player List</button>
            <button style="background: #ff0000; color: white; padding: 8px 16px; border: 2px solid white; border-radius: 5px; cursor: pointer; z-index: 10001; position: relative; display: inline-block; margin: 5px;" onclick="togglePOV()">Toggle POV</button>
            <button style="background: #ff0000; color: white; padding: 8px 16px; border: 2px solid white; border-radius: 5px; cursor: pointer; z-index: 10001; position: relative; display: inline-block; margin: 5px;" onclick="reportPlayerUI()">Report Player</button>
            <button style="background: #ff0000; color: white; padding: 8px 16px; border: 2px solid white; border-radius: 5px; cursor: pointer; z-index: 10001; position: relative; display: inline-block; margin: 5px;" onclick="togglePublicChat()">Public Chat</button>
            <button style="background: #ff0000; color: white; padding: 8px 16px; border: 2px solid white; border-radius: 5px; cursor: pointer; z-index: 10001; position: relative; display: inline-block; margin: 5px;" onclick="toggleFriendBox()">Friends</button>
            <button style="background: #ff0000; color: white; padding: 8px 16px; border: 2px solid white; border-radius: 5px; cursor: pointer; z-index: 10001; position: relative; display: inline-block; margin: 5px;" onclick="testUI()">Test UI</button>
            <button style="background: #ff0000; color: white; padding: 8px 16px; border: 2px solid white; border-radius: 5px; cursor: pointer; z-index: 10001; position: relative; display: inline-block; margin: 5px;" onclick="testUI2()">Test UI 2</button>
        `;
        console.log('Main menu rendered:', ui.innerHTML);
    } catch (e) {
        console.error('Render main menu error:', e);
        alert('Error rendering main menu. Check console.');
    }
}

function closeVote() {
    try {
        document.getElementById('voteBox').style.display = 'none';
        console.log('Closed vote box');
    } catch (e) {
        console.error('Close vote error:', e);
        alert('Error closing vote box. Check console.');
    }
}

function startGame() {
    try {
        console.log('Starting game');
        let player = {
            x: 400,
            y: 300,
            z: 0,
            speed: 5,
            jumping: false,
            jumpHeight: 50,
            jumpProgress: 0,
            walkProgress: 0,
            direction: 0,
            username: username,
            equippedSkin: equippedSkin,
            equippedWeapon: equippedWeapon
        };
        players[username] = player;
        localStorage.setItem(`coneWorksPlayers_${sessionId}`, JSON.stringify(players));
        canvas.style.display = 'block';
        ui.style.display = 'none'; // Hide main menu during game
        console.log('Game started, UI hidden');
        let keys = {};

        document.addEventListener('keydown', (e) => {
            keys[e.key] = true;
            if (e.key === ' ' && !player.jumping) {
                player.jumping = true;
                player.jumpProgress = 0;
                console.log('Jump started:', username);
            }
            if (e.key === 'c') {
                togglePublicChat();
            }
            if (e.key === 'e' && currentServer.mode === 'fight') {
                console.log('Attack initiated:', username);
            }
        });

        document.addEventListener('keyup', (e) => {
            keys[e.key] = false;
        });

        function updateGame() {
            try {
                ctx.clearRect(0, 0, canvas.width, canvas.height);
                let moving = false;

                if (keys['ArrowLeft'] || keys['a']) {
                    player.x = Math.max(0, player.x - player.speed);
                    player.direction = -1;
                    moving = true;
                }
                if (keys['ArrowRight'] || keys['d']) {
                    player.x = Math.min(800, player.x + player.speed);
                    player.direction = 1;
                    moving = true;
                }
                if (keys['ArrowUp'] || keys['w']) {
                    player.y = Math.max(285, player.y - player.speed);
                    moving = true;
                }
                if (keys['ArrowDown'] || keys['s']) {
                    player.y = Math.min(450, player.y + player.speed);
                    moving = true;
                }

                if (player.jumping) {
                    player.jumpProgress += 0.05;
                    if (player.jumpProgress < 0.5) {
                        player.z = player.jumpHeight * Math.sin(player.jumpProgress * Math.PI);
                    } else if (player.jumpProgress >= 1) {
                        player.jumping = false;
                        player.z = 0;
                        player.jumpProgress = 0;
                    }
                    console.log('Jump progress:', player.jumpProgress, 'Z:', player.z);
                }

                if (moving) {
                    player.walkProgress += 0.1;
                } else {
                    player.walkProgress = 0;
                }

                players[username] = player;
                localStorage.setItem(`coneWorksPlayers_${sessionId}`, JSON.stringify(players));

                Object.values(players).forEach(p => drawPlayer(p));
                requestAnimationFrame(updateGame);
            } catch (e) {
                console.error('Update game error:', e);
                alert('Error updating game. Check console.');
            }
        }

        function drawPlayer(p) {
            try {
                ctx.save();
                ctx.translate(p.x, p.y - p.z);

                // Jump animation: 30% vertical stretch
                let scaleY = 1;
                if (p.jumping) {
                    scaleY = p.jumpProgress < 0.5 ? 1 + p.jumpProgress * 0.3 : 1.3 - (p.jumpProgress - 0.5) * 0.3;
                }
                ctx.scale(1, scaleY);

                // Walk animation: ±28° leg rotation
                let legAngle = p.walkProgress ? Math.sin(p.walkProgress * Math.PI) * (28 * Math.PI / 180) : 0;

                // Draw stick figure
                ctx.fillStyle = skins[p.equippedSkin || 'default-boy'].color.map(c => c * 255).join(',');
                ctx.beginPath();
                ctx.arc(0, -20, 10, 0, Math.PI * 2); // Head
                ctx.fill();

                ctx.beginPath();
                ctx.moveTo(0, -10);
                ctx.lineTo(0, 10); // Body
                ctx.strokeStyle = ctx.fillStyle;
                ctx.lineWidth = 5;
                ctx.stroke();

                // Arms
                ctx.beginPath();
                ctx.moveTo(0, -5);
                ctx.lineTo(p.direction === 1 ? -15 : 15, 5);
                ctx.moveTo(0, -5);
                ctx.lineTo(p.direction === 1 ? 15 : -15, 5);
                ctx.stroke();

                // Legs with walk animation
                ctx.save();
                ctx.translate(0, 10);
                ctx.rotate(legAngle);
                ctx.beginPath();
                ctx.moveTo(0, 0);
                ctx.lineTo(-10, 20);
                ctx.stroke();
                ctx.restore();

                ctx.save();
                ctx.translate(0, 10);
                ctx.rotate(-legAngle);
                ctx.beginPath();
                ctx.moveTo(0, 0);
                ctx.lineTo(10, 20);
                ctx.stroke();
                ctx.restore();

                // Nametag
                ctx.fillStyle = 'white';
                ctx.font = '12px Arial';
                ctx.textAlign = 'center';
                ctx.fillText(p.username || 'Player', 0, -30);

                ctx.restore();
            } catch (e) {
                console.error('Draw player error:', e);
                alert('Error drawing player. Check console.');
            }
        }

        updateGame();
        console.log('Game started');
    } catch (e) {
        console.error('Start game error:', e);
        alert('Error starting game. Check console.');
    }
}

function openSkinShop() {
    try {
        const skinList = document.getElementById('skinList');
        skinList.innerHTML = Object.keys(skins).map(s => `<div>${s} (${skins[s].cost} Conecons) <button onclick="buySkin('${s}')">Buy</button></div>`).join('');
        document.getElementById('skinBox').style.display = 'block';
        console.log('Opened skin shop');
    } catch (e) {
        console.error('Open skin shop error:', e);
        alert('Error opening skin shop. Check console.');
    }
}

function buySkin(skin) {
    try {
        if (conecon >= skins[skin].cost) {
            conecon -= skins[skin].cost;
            equippedSkin = skin;
            accounts[username].conecon = conecon;
            accounts[username].equippedSkin = skin;
            localStorage.setItem(`coneWorksAccounts_${sessionId}`, JSON.stringify(accounts));
            updateConeconDisplay();
            document.getElementById('skinBox').style.display = 'none';
            alert(`Purchased ${skin}!`);
            console.log('Skin purchased:', skin, 'Conecons:', conecon);
        } else {
            alert('Not enough Conecons!');
            console.log('Buy skin failed: Insufficient conecons', conecon, 'needed', skins[skin].cost);
        }
    } catch (e) {
        console.error('Buy skin error:', e);
        alert('Error buying skin. Check console.');
    }
}

function openWeaponShop() {
    try {
        const weaponList = document.getElementById('weaponList');
        weaponList.innerHTML = Object.keys(weapons).map(w => `<div>${w} (${weapons[w].cost} Conecons) <button onclick="buyWeapon('${w}')">Buy</button></div>`).join('');
        document.getElementById('shopBox').style.display = 'block';
        console.log('Opened weapon shop');
    } catch (e) {
        console.error('Open weapon shop error:', e);
        alert('Error opening weapon shop. Check console.');
    }
}

function buyWeapon(weapon) {
    try {
        if (conecon >= weapons[weapon].cost) {
            conecon -= weapons[weapon].cost;
            equippedWeapon = weapon;
            accounts[username].conecon = conecon;
            accounts[username].equippedWeapon = weapon;
            localStorage.setItem(`coneWorksAccounts_${sessionId}`, JSON.stringify(accounts));
            updateConeconDisplay();
            document.getElementById('shopBox').style.display = 'none';
            alert(`Purchased ${weapon}!`);
            console.log('Weapon purchased:', weapon, 'Conecons:', conecon);
        } else {
            alert('Not enough Conecons!');
            console.log('Buy weapon failed: Insufficient conecons', conecon, 'needed', weapons[weapon].cost);
        }
    } catch (e) {
        console.error('Buy weapon error:', e);
        alert('Error buying weapon. Check console.');
    }
}

function togglePOV() {
    try {
        pov = pov === 'third' ? 'first' : 'third';
        accounts[username].pov = pov;
        localStorage.setItem(`coneWorksAccounts_${sessionId}`, JSON.stringify(accounts));
        alert(`Switched to ${pov}-person view!`);
        console.log('Toggled POV:', pov);
    } catch (e) {
        console.error('Toggle POV error:', e);
        alert('Error toggling POV. Check console.');
    }
}

function reportPlayerUI() {
    try {
        const reportPlayer = document.getElementById('reportPlayer');
        reportPlayer.innerHTML = currentServer.players.filter(p => p !== username).map(p => `<option value="${p}">${p}</option>`).join('');
        document.getElementById('reportBox').style.display = 'block';
        console.log('Opened report player UI');
    } catch (e) {
        console.error('Report player UI error:', e);
        alert('Error opening report UI. Check console.');
    }
}

function submitReport() {
    try {
        const reportedPlayer = document.getElementById('reportPlayer').value;
        if (reportedPlayer && reportedPlayer !== username) {
            reports.push({ reporter: username, reported: reportedPlayer, server: currentServer.name, timestamp: Date.now() });
            localStorage.setItem(`coneWorksReports_${sessionId}`, JSON.stringify(reports));
            document.getElementById('reportBox').style.display = 'none';
            alert(`Reported ${reportedPlayer}!`);
            console.log('Report submitted:', reportedPlayer, 'by', username);
        } else {
            alert('Invalid player to report!');
            console.log('Report failed: Invalid player', reportedPlayer);
        }
    } catch (e) {
        console.error('Submit report error:', e);
        alert('Error submitting report. Check console.');
    }
}

function reviewReports() {
    try {
        if (username.toLowerCase() !== 'conehead8654') {
            alert('Only conehead8654 can review reports!');
            console.log('Review reports failed: Unauthorized user', username);
            return;
        }
        const reportList = document.getElementById('reportList');
        reportList.innerHTML = reports.map((r, i) => `<div>${r.reporter} reported ${r.reported} on ${r.server} <button onclick="banPlayer('${r.reported}', ${i})">Ban</button></div>`).join('');
        document.getElementById('reviewReportsBox').style.display = 'block';
        console.log('Opened review reports');
    } catch (e) {
        console.error('Review reports error:', e);
        alert('Error reviewing reports. Check console.');
    }
}

function banPlayer(player, reportIndex) {
    try {
        if (username.toLowerCase() !== 'conehead8654') {
            alert('Only conehead8654 can ban players!');
            console.log('Ban failed: Unauthorized user', username);
            return;
        }
        if (!bannedPlayers.includes(player)) {
            bannedPlayers.push(player);
            localStorage.setItem(`coneWorksBannedPlayers_${sessionId}`, JSON.stringify(bannedPlayers));
            servers.forEach(s => s.players = s.players.filter(p => p !== player));
            localStorage.setItem(`coneWorksServers_${sessionId}`, JSON.stringify(servers));
            reports.splice(reportIndex, 1);
            localStorage.setItem(`coneWorksReports_${sessionId}`, JSON.stringify(reports));
            document.getElementById('reviewReportsBox').style.display = 'none';
            alert(`${player} banned!`);
            console.log('Player banned:', player);
        } else {
            alert('Player already banned!');
            console.log('Ban failed: Player already banned', player);
        }
    } catch (e) {
        console.error('Ban player error:', e);
        alert('Error banning player. Check console.');
    }
}

function togglePlayerList() {
    try {
        const playerList = document.getElementById('playerList');
        playerList.innerHTML = Object.keys(accounts).map(u => {
            return `<tr><td>${u}</td><td>${accounts[u].wins || 0}</td><td>${accounts[u].conecon || 0}</td><td><button onclick="reportPlayerUI()">Report</button></td></tr>`;
        }).join('');
        document.getElementById('playerListBox').style.display = document.getElementById('playerListBox').style.display === 'none' ? 'block' : 'none';
        console.log('Toggled player list');
    } catch (e) {
        console.error('Toggle player list error:', e);
        alert('Error toggling player list. Check console.');
    }
}

function togglePublicChat() {
    try {
        const chat = document.getElementById('publicChat');
        chat.style.display = chat.style.display === 'none' ? 'block' : 'none';
        if (chat.style.display === 'block') updatePublicChat();
        console.log('Toggled public chat:', chat.style.display);
    } catch (e) {
        console.error('Toggle public chat error:', e);
        alert('Error toggling public chat. Check console.');
    }
}

function sendPublicMessage() {
    try {
        const input = document.getElementById('publicChatInput');
        const message = input.value.trim();
        if (message && currentServer) {
            publicMessages.push({ sender: username, message, timestamp: Date.now() });
            localStorage.setItem(`coneWorksMessages_${sessionId}`, JSON.stringify(publicMessages));
            input.value = '';
            updatePublicChat();
            console.log('Sent public message:', message);
        }
    } catch (e) {
        console.error('Send public message error:', e);
        alert('Error sending public message. Check console.');
    }
}

function updatePublicChat() {
    try {
        const messagesDiv = document.getElementById('publicChatMessages');
        messagesDiv.innerHTML = publicMessages.map(m => `<div>${m.sender}: ${m.message}</div>`).join('');
        messagesDiv.scrollTop = messagesDiv.scrollHeight;
        console.log('Updated public chat');
    } catch (e) {
        console.error('Update public chat error:', e);
        alert('Error updating public chat. Check console.');
    }
}

function toggleChatBox() {
    try {
        const chatBox = document.getElementById('chatBox');
        chatBox.style.display = chatBox.style.display === 'none' ? 'block' : 'none';
        if (chatBox.style.display === 'block') updateChat();
        console.log('Toggled chat box:', chatBox.style.display);
    } catch (e) {
        console.error('Toggle chat box error:', e);
        alert('Error toggling chat box. Check console.');
    }
}

function sendMessage() {
    try {
        const input = document.getElementById('chatInput');
        const message = input.value.trim();
        if (message) {
            messages.push({ sender: username, message, timestamp: Date.now() });
            localStorage.setItem(`coneWorksMessages_${sessionId}`, JSON.stringify(messages));
            input.value = '';
            updateChat();
            console.log('Sent friend message:', message);
        }
    } catch (e) {
        console.error('Send message error:', e);
        alert('Error sending friend message. Check console.');
    }
}

function updateChat() {
    try {
        const messagesDiv = document.getElementById('chatMessages');
        messagesDiv.innerHTML = messages.filter(m => friends.includes(m.sender) || m.sender === username).map(m => `<div>${m.sender}: ${m.message}</div>`).join('');
        messagesDiv.scrollTop = messagesDiv.scrollHeight;
        console.log('Updated friend chat');
    } catch (e) {
        console.error('Update chat error:', e);
        alert('Error updating friend chat. Check console.');
    }
}

function toggleFriendBox() {
    try {
        const friendBox = document.getElementById('friendBox');
        friendBox.style.display = friendBox.style.display === 'none' ? 'block' : 'none';
        if (friendBox.style.display === 'block') updateFriendList();
        console.log('Toggled friend box:', friendBox.style.display);
    } catch (e) {
        console.error('Toggle friend box error:', e);
        alert('Error toggling friend box. Check console.');
    }
}

function updateFriendList() {
    try {
        const friendList = document.getElementById('friendList');
        friendList.innerHTML = friends.length ? friends.map(f => `<div>${f} <button onclick="removeFriend('${f}')">Remove</button></div>`).join('') : '<div>No friends yet!</div>';
        const requests = document.getElementById('friendRequests');
        requests.innerHTML = friendRequestsReceived.length ? friendRequestsReceived.map(r => `<div>${r} <button onclick="acceptFriendRequest('${r}')">Accept</button> <button onclick="declineFriendRequest('${r}')">Decline</button></div>`).join('') : '<div>No friend requests!</div>';
        console.log('Updated friend list');
    } catch (e) {
        console.error('Update friend list error:', e);
        alert('Error updating friend list. Check console.');
    }
}

function sendFriendRequest() {
    try {
        const friend = document.getElementById('friendSearch').value.trim();
        const friendLower = friend.toLowerCase();
        let matchedFriend = Object.keys(accounts).find(u => u.toLowerCase() === friendLower);
        if (!matchedFriend || matchedFriend === username || friends.includes(matchedFriend) || friendRequestsSent.includes(matchedFriend)) {
            alert('Invalid user, already friends, or request already sent!');
            console.log('Send friend request failed:', friend);
            return;
        }
        friendRequestsSent.push(matchedFriend);
        accounts[username].requestsSent = friendRequestsSent;
        let received = JSON.parse(localStorage.getItem(`coneWorksRequestsReceived_${sessionId}`)) || {};
        received[matchedFriend] = received[matchedFriend] || [];
        received[matchedFriend].push(username);
        localStorage.setItem(`coneWorksRequestsReceived_${sessionId}`, JSON.stringify(received));
        localStorage.setItem(`coneWorksAccounts_${sessionId}`, JSON.stringify(accounts));
        document.getElementById('friendSearch').value = '';
        updateFriendList();
        alert(`Friend request sent to ${matchedFriend}!`);
        console.log('Friend request sent to:', matchedFriend);
    } catch (e) {
        console.error('Send friend request error:', e);
        alert('Error sending friend request. Check console.');
    }
}

function acceptFriendRequest(friend) {
    try {
        friends.push(friend);
        accounts[username].friends = friends;
        friendRequestsReceived = friendRequestsReceived.filter(r => r !== friend);
        let received = JSON.parse(localStorage.getItem(`coneWorksRequestsReceived_${sessionId}`)) || {};
        received[username] = friendRequestsReceived;
        localStorage.setItem(`coneWorksRequestsReceived_${sessionId}`, JSON.stringify(received));
        accounts[friend].friends = accounts[friend].friends || [];
        accounts[friend].friends.push(username);
        accounts[friend].requestsSent = accounts[friend].requestsSent.filter(r => r !== username);
        localStorage.setItem(`coneWorksAccounts_${sessionId}`, JSON.stringify(accounts));
        updateFriendList();
        alert(`Accepted friend request from ${friend}!`);
        console.log('Accepted friend request from:', friend);
    } catch (e) {
        console.error('Accept friend request error:', e);
        alert('Error accepting friend request. Check console.');
    }
}

function declineFriendRequest(friend) {
    try {
        friendRequestsReceived = friendRequestsReceived.filter(r => r !== friend);
        let received = JSON.parse(localStorage.getItem(`coneWorksRequestsReceived_${sessionId}`)) || {};
        received[username] = friendRequestsReceived;
        localStorage.setItem(`coneWorksRequestsReceived_${sessionId}`, JSON.stringify(received));
        accounts[friend].requestsSent = accounts[friend].requestsSent.filter(r => r !== username);
        localStorage.setItem(`coneWorksAccounts_${sessionId}`, JSON.stringify(accounts));
        updateFriendList();
        alert(`Declined friend request from ${friend}!`);
        console.log('Declined friend request from:', friend);
    } catch (e) {
        console.error('Decline friend request error:', e);
        alert('Error declining friend request. Check console.');
    }
}

function removeFriend(friend) {
    try {
        friends = friends.filter(f => f !== friend);
        accounts[username].friends = friends;
        accounts[friend].friends = accounts[friend].friends.filter(f => f !== username);
        localStorage.setItem(`coneWorksAccounts_${sessionId}`, JSON.stringify(accounts));
        updateFriendList();
        alert(`Removed ${friend} from friends!`);
        console.log('Removed friend:', friend);
    } catch (e) {
        console.error('Remove friend error:', e);
        alert('Error removing friend. Check console.');
    }
}

function updateFriendSuggestions() {
    try {
        const search = document.getElementById('friendSearch').value.toLowerCase();
        const suggestions = document.getElementById('friendSuggestions');
        suggestions.innerHTML = '';
        Object.keys(accounts).filter(u => u.toLowerCase().includes(search) && u !== username && !friends.includes(u) && !friendRequestsSent.includes(u)).slice(0, 5).forEach(u => {
            const div = document.createElement('div');
            div.className = 'suggestion';
            div.textContent = u;
            div.onclick = () => {
                document.getElementById('friendSearch').value = u;
                updateFriendSuggestions();
            };
            suggestions.appendChild(div);
        });
        console.log('Updated friend suggestions');
    } catch (e) {
        console.error('Update friend suggestions error:', e);
        alert('Error updating friend suggestions. Check console.');
    }
}

function testMultiplayer() {
    try {
        alert('Testing multiplayer: Players in session ' + sessionId + ': ' + Object.keys(players).length);
        console.log('Multiplayer test:', Object.keys(players), 'Session:', sessionId);
    } catch (e) {
        console.error('Test multiplayer error:', e);
        alert('Error testing multiplayer. Check console.');
    }
}

function testUI() {
    try {
        console.log('Testing UI: Adding test button to body');
        const existingButton = document.getElementById('testButton');
        if (existingButton) existingButton.remove();
        const button = document.createElement('button');
        button.id = 'testButton';
        button.textContent = 'Test UI';
        button.style.cssText = 'background: #ff0000; color: white; padding: 8px 16px; border: 2px solid white; border-radius: 5px; cursor: pointer; z-index: 10001; position: absolute; top: 90px; right: 10px;';
        button.onclick = () => alert('Test UI button clicked!');
        document.body.appendChild(button);
        console.log('Test UI button added');
    } catch (e) {
        console.error('Test UI error:', e);
        alert('Error testing UI. Check console.');
    }
}

function testUI2() {
    try {
        console.log('Testing UI 2: Adding second test button to body');
        const existingButton = document.getElementById('testButton2');
        if (existingButton) existingButton.remove();
        const button = document.createElement('button');
        button.id = 'testButton2';
        button.textContent = 'Test UI 2';
        button.style.cssText = 'background: #ff0000; color: white; padding: 8px 16px; border: 2px solid white; border-radius: 5px; cursor: pointer; z-index: 10001; position: absolute; top: 130px; right: 10px;';
        button.onclick = () => alert('Test UI 2 button clicked!');
        document.body.appendChild(button);
        console.log('Test UI 2 button added');
    } catch (e) {
        console.error('Test UI 2 error:', e);
        alert('Error testing UI 2. Check console.');
    }
}

// Initialize default admin account
if (!accounts['conehead8654']) {
    accounts['conehead8654'] = {
        password: 'Di@d09202015',
        friends: [],
        requestsSent: [],
        requestsReceived: [],
        wins: 0,
        conecon: 100,
        equippedSkin: 'default-boy',
        equippedWeapon: 'fist',
        pov: 'third'
    };
    localStorage.setItem(`coneWorksAccounts_${sessionId}`, JSON.stringify(accounts));
    console.log('Initialized default admin account: conehead8654');
}

// Start Conecon timer
setInterval(() => {
    try {
        if (currentServer) {
            conecon += 1;
            accounts[username].conecon = conecon;
            localStorage.setItem(`coneWorksAccounts_${sessionId}`, JSON.stringify(accounts));
            updateConeconDisplay();
            console.log('Conecon incremented:', conecon);
        }
    } catch (e) {
        console.error('Conecon timer error:', e);
        alert('Error updating Conecons. Check console.');
    }
}, 60000);

console.log('ConeWorks initialized, version:', version, 'Session:', sessionId);
</script>
